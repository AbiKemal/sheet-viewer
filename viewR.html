<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Kartu Tabungan Qurban</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f6f6f6;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 900px;
      margin: auto;
      background: #fff;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    h2, p {
      text-align: center;
      margin: 4px 0;
    }
    .info {
      display: flex;
      justify-content: space-between;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    .info div {
      flex: 1 1 50%;
    }
    .info .right {
      text-align: right;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      font-size: 14px;
    }
    th, td {
      padding: 10px;
      border: 1px solid #ccc;
      text-align: left;
    }
    td.right {
      text-align: right;
    }
    .total-row td {
      font-weight: bold;
      background-color: #f0f0f0;
    }
    @media (max-width: 600px) {
      .info {
        flex-direction: column;
      }
      .info .right {
        text-align: left;
      }
    }
  </style>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script>
    const sheetId = '1aNWfGYIqARaSmDXl0eqJ5Sy6htOgBgMTIZC1SlZA0vA';
    const namaPeserta = 'MANG PEPEN';

    async function fetchData() {
      const bulanUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=LIST_BULAN&tq=SELECT B`;
      const dataUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=DATABASE&tq=${encodeURIComponent("SELECT B, C, D, E, H WHERE B = '" + namaPeserta + "'")}`;

      const [bulanRes, dataRes] = await Promise.all([fetch(bulanUrl), fetch(dataUrl)]);
      const bulanJson = JSON.parse(bulanRes.text().replace(/.*?({.*})/, '$1'));
      const dataJson = JSON.parse(dataRes.text().replace(/.*?({.*})/, '$1'));

      const bulanList = bulanJson.table.rows.map(row => row.c[0] ? row.c[0].v : '');
      const records = dataJson.table.rows.map(row => ({
        bulan: row.c[1]?.v || '',
        jumlah: row.c[2]?.v || 0,
        tanggal: row.c[3]?.f || '',
        keterangan: row.c[4]?.v || ''
      }));

      let tableHTML = '';
      let total = 0;

      for (let i = 0; i < 12; i++) {
        const bulan = bulanList[i] || `Bulan ${i+1}`;
        const record = records.find(r => r.bulan?.toUpperCase() === bulan?.toUpperCase());
        const ke = i + 1;
        const jumlah = record ? record.jumlah : '';
        const tanggal = record ? record.tanggal : '';
        const keterangan = record ? record.keterangan : '';

        if (jumlah) total += jumlah;

        tableHTML += `
          <tr>
            <td>${ke}</td>
            <td>${bulan}</td>
            <td>${tanggal}</td>
            <td class="right">${jumlah ? 'Rp ' + jumlah.toLocaleString('id-ID') : ''}</td>
            <td>${keterangan}</td>
          </tr>`;
      }

      tableHTML += `
        <tr class="total-row">
          <td colspan="3">TOTAL TABUNGAN</td>
          <td class="right">Rp ${total.toLocaleString('id-ID')}</td>
          <td></td>
        </tr>`;

      document.getElementById('tabel-body').innerHTML = tableHTML;
    }

    window.onload = fetchData;
  </script>
</head>
<body>
  <div class="container">
    <h2>KARTU TABUNGAN QURBAN TAHUN 2026</h2>
    <p>Kp.Pasar Senen Desa Ciasihan Kec. Pamijahan</p>
    <div class="info">
      <div><strong>NAMA:</strong> MANG PEPEN</div>
      <div class="right">
        <strong>Jumlah Dana Qurban</strong><br>
        <strong>RP 3.000.000</strong>
      </div>
    </div>

    <table>
      <thead>
        <tr>
          <th>Tabungan Ke</th>
          <th>Bulan</th>
          <th>Tanggal Pembayaran</th>
          <th>Jumlah Tabungan</th>
          <th>Keterangan</th>
        </tr>
      </thead>
      <tbody id="tabel-body">
        <tr><td colspan="5">Memuat data...</td></tr>
      </tbody>
    </table>
  </div>
</body>
</html>
